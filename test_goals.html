<!DOCTYPE html>
<html>
<head>
    <title>Goals Feature Test</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #6366f1; }
        .test-item { margin: 10px 0; padding: 10px; background: #f9f9f9; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Goals Feature Test</h1>
    
    <div class="test-section">
        <h2>Test Setup</h2>
        <button onclick="setupTestData()">Create Test Data (Habits + Goals)</button>
        <button onclick="clearAllData()">Clear All Data</button>
        <div id="setup-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Goals Functions Test</h2>
        <div id="function-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>Goals Data Test</h2>
        <div id="data-tests"></div>
    </div>
    
    <script>
        function setupTestData() {
            const output = document.getElementById('setup-output');
            output.innerHTML = '';
            
            try {
                // Clear existing data
                localStorage.clear();
                
                // Create test habits
                const habits = [
                    {
                        id: 1,
                        name: "Morning Run",
                        category: "Fitness",
                        linkedGoals: [1],
                        frequency: { type: 'daily', days: [] },
                        completed: true,
                        completedDate: new Date().toISOString(),
                        createdDate: new Date().toISOString(),
                        streak: { currentStreak: 5, longestStreak: 10 },
                        reminderTime: null
                    },
                    {
                        id: 2,
                        name: "Read Book",
                        category: "Study",
                        linkedGoals: [1],
                        frequency: { type: 'daily', days: [] },
                        completed: false,
                        completedDate: null,
                        createdDate: new Date().toISOString(),
                        streak: { currentStreak: 0, longestStreak: 3 },
                        reminderTime: null
                    }
                ];
                
                localStorage.setItem('modernHabitTracker', JSON.stringify(habits));
                output.innerHTML += '<div class="test-item"><span class="pass">✓</span> Created 2 test habits</div>';
                
                // Create test goals
                const goals = [
                    {
                        id: 1,
                        goalName: "Health & Learning Goal",
                        description: "Complete 20 workouts and reading sessions",
                        targetValue: 20,
                        linkedHabits: [1, 2],
                        deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        createdDate: new Date().toISOString()
                    },
                    {
                        id: 2,
                        goalName: "Fitness Challenge",
                        description: "Run 50 times this month",
                        targetValue: 50,
                        linkedHabits: [1],
                        deadline: null,
                        createdDate: new Date().toISOString()
                    }
                ];
                
                localStorage.setItem('habitGoals', JSON.stringify(goals));
                output.innerHTML += '<div class="test-item"><span class="pass">✓</span> Created 2 test goals</div>';
                
                output.innerHTML += '<div class="test-item" style="margin-top: 15px; font-size: 13px; color: #666;">Now navigate to <strong>Goals</strong> tab in the app to see the goals rendered</div>';
                
            } catch (e) {
                output.innerHTML += '<div class="test-item"><span class="fail">✗</span> Error: ' + e.message + '</div>';
            }
        }
        
        function clearAllData() {
            localStorage.clear();
            document.getElementById('setup-output').innerHTML = '<div class="test-item"><span class="pass">✓</span> All data cleared</div>';
        }
        
        // Check if functions exist and are accessible
        function testFunctions() {
            const output = document.getElementById('function-tests');
            output.innerHTML = '';
            
            const requiredFunctions = [
                'calculateGoalProgress',
                'renderGoalsPage',
                'openAddGoalModal',
                'openEditGoalModal'
            ];
            
            // Open app in iframe or check window
            const testResults = [];
            
            // Note: Functions would need to be loaded from the main app
            testResults.push('Functions will be accessible when app loads. Check console for errors.');
            
            output.innerHTML = testResults.map(r => `<div class="test-item">${r}</div>`).join('');
        }
        
        // Run tests on load
        window.addEventListener('load', () => {
            testFunctions();
        });
    </script>
</body>
</html>
